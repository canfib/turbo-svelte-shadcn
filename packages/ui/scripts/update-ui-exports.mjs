import fs from 'fs';
import path from 'path';

// This script now runs from the 'packages/ui' directory
// So we resolve paths from 'process.cwd()' which is .../packages/ui
const componentsDir = path.resolve(process.cwd(), 'src/components');
const indexPath = path.resolve(process.cwd(), 'src/index.ts');
const header = `// This file is auto-generated by scripts/update-ui-exports.mjs. Do not edit.\n\n`;

try {
  // 1. Find all component directories (e.g., 'button', 'input')
  const componentDirs = fs
    .readdirSync(componentsDir, { withFileTypes: true })
    .filter((dirent) => dirent.isDirectory())
    .map((dirent) => dirent.name);

  // 2. Generate the export lines
  const exportLines = componentDirs
    .map((dir) => {
      // Convert directory name (e.g., 'alert-dialog') to PascalCase (e.g., 'AlertDialog')
      const componentName = dir
        .split('-')
        .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
        .join('');

      // Create the export line
      // e.g., export { AlertDialog } from './components/alert-dialog';
      return `export { ${componentName} } from './components/${dir}';`;
    })
    .join('\n');

  // 3. Write the new content to packages/ui/src/index.ts
  fs.writeFileSync(indexPath, header + exportLines + '\n');

  console.log(`âœ… Updated packages/ui/src/index.ts with ${componentDirs.length} components.`);
} catch (error) {
  console.error('Error updating UI index:', error);
  process.exit(1);
}
